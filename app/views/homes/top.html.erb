<h1 class="text-center mt-4">保育園情報などを交換しましょう♪</h1>
<h3 class="text-center">まずは気になる保育園を探す</h3>
<div class= "box mt-4">
	<div class= "search">
		<h5>フリーワードで検索する</h5>
		<%= form_with url: search_facilities_path, local: true, method: :get, class: "search-form" do |f| %>
			<%= f.text_field :keyword, placeholder: "保育園を検索", class: "search-input" %><br>
			<%= f.submit "検索", class: "btn btn-warning" %>
		<% end %>
	</div>
	<div class="map-container">
		<h5 class="map-title">現在地に近い保育園を見つける</h5>
		<div id="map" style="width: 500px; height: 400px;"></div>
	</div>
</div>
	<script>
		function initMap() {
			// 現在地の緯度と経度を取得する
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(
					(position) => {
						const currentLatitude = position.coords.latitude;
						const currentLongitude = position.coords.longitude;
						const currentLocation = { lat: currentLatitude, lng: currentLongitude };

						// 地図を表示する
						const map = new google.maps.Map(document.getElementById('map'), {
							center: currentLocation,
							zoom: 15
						});

						// オリジナルのアイコン画像をカスタムアイコンとして指定する
						const customIcon = {
						url: '<%= asset_path('currentLocation.jpeg') %>',
						scaledSize: new google.maps.Size(40, 30),
						};

						// 現在地のマーカーを表示する
						new google.maps.Marker({
							position: currentLocation,
							map: map,
							title: '現在地',
							icon: customIcon
						});

						//　保育園の場所のマーカーを表示する
						<% @facilities.each do |facility| %>
							new google.maps.Marker({
									position: { lat: <%= facility.latitude %>, lng: <%= facility.longitude %> },
									map: map,
									title: '<%= facility.name %>'
							});
						<% end %>
					},
					() => {
						alert('現在地を取得できませんでした。');
					}
				);
			} else {
				alert('このブラウザはGeolocationに対応していません。');
			}
		}
	</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>
